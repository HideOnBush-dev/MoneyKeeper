{% extends "base.html" %} {% block content %}

<!-- Add outer container with padding-bottom for mobile -->
<div class="pb-32 sm:pb-0">  <!-- Added padding-bottom to prevent form cut-off -->
  <div class="animate__animated animate__fadeIn max-w-lg mx-auto">
    <!-- Header Card -->
    <div class="bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-t-xl p-4 sm:p-6">
      <h1 class="text-2xl font-bold flex items-center">
        <svg
          class="w-6 h-6 mr-2"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"
          />
        </svg>
        Chỉnh sửa ví
      </h1>
      <p class="mt-1 text-blue-100">{{ wallet.name }}</p>
    </div>

    <!-- Main Form -->
    <div class="bg-white rounded-b-xl shadow-lg">
      <form method="POST" class="divide-y divide-gray-200">
        <!-- Form Fields Container -->
        <div class="p-4 sm:p-6 space-y-4 sm:space-y-6">
          {{ form.hidden_tag() }}

          <div class="space-y-4">
            <!-- Wallet Name -->
            <div class="space-y-2">
              {{ form.name.label(class="block text-sm font-medium text-gray-700") }}
              {{ form.name(class="mt-1 block w-full rounded-lg border-gray-300
              shadow-sm focus:ring-blue-500 focus:border-blue-500 py-3 text-base") }}
            </div>

            <!-- Balance -->
            <div class="space-y-2">
              {{ form.balance.label(class="block text-sm font-medium text-gray-700")
              }}
              <div class="relative rounded-lg shadow-sm">
                <div
                  class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"
                >
                  <span class="text-gray-500 text-lg">₫</span>
                </div>
                {{ form.balance(class="pl-8 block w-full rounded-lg border-gray-300
                focus:ring-blue-500 focus:border-blue-500 py-4 text-lg", placeholder="0",
                inputmode="decimal", pattern="[0-9]*") }}
              </div>
            </div>

            <!-- Description -->
            <div class="space-y-2">
              {{ form.description.label(class="block text-sm font-medium
              text-gray-700") }} {{ form.description(class="mt-1 block w-full
              rounded-lg border-gray-300 shadow-sm focus:ring-blue-500
              focus:border-blue-500", rows="3") }}
            </div>

            <!-- Is Default Toggle -->
            <div class="space-y-2">
              <div class="flex items-center justify-between">
                {{ form.is_default.label(class="block text-sm font-medium
                text-gray-700") }}
                <div class="relative inline-block w-10 mr-2 align-middle">
                  {{ form.is_default(class="mt-1 block rounded-lg border-gray-300
                  shadow-sm focus:ring-blue-500 focus:border-blue-500") }}
                </div>
              </div>
              <p class="text-sm text-gray-500">
                Ví mặc định sẽ được chọn tự động khi thêm giao dịch mới
              </p>
            </div>
          </div>
        </div>

        <!-- Action Buttons - Fixed on Mobile -->
        <div class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4 sm:relative sm:border-t-0 sm:p-6 sm:bg-transparent">
          <div class="flex gap-3 max-w-lg mx-auto">
            <a href="{{ url_for('main.wallets') }}"
               class="flex-1 py-3 px-4 border border-gray-300 rounded-lg text-center text-gray-700 hover:bg-gray-50">
              Hủy
            </a>
            {{ form.submit(class="flex-1 py-3 px-4 border border-transparent rounded-lg text-white bg-blue-600 hover:bg-blue-700") }}
          </div>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
// Format money with dots
function formatMoney(input) {
    // Remove existing dots and non-digit characters
    let value = input.replace(/\D/g, '');
    // Format with dots
    return value.replace(/\B(?=(\d{3})+(?!\d))/g, ".");
}

// Parse money string to number
function parseMoney(str) {
    return parseInt(str.replace(/\./g, '')) || 0;
}

// Add format to balance input
document.getElementById('balance').addEventListener('input', function(e) {
    let value = formatMoney(e.target.value);
    e.target.value = value;
});

// Format initial value
document.addEventListener('DOMContentLoaded', function() {
    const balanceInput = document.getElementById('balance');
    balanceInput.value = formatMoney(balanceInput.value);
});

// Parse before form submit
document.querySelector('form').addEventListener('submit', function(e) {
    const balanceInput = document.getElementById('balance');
    balanceInput.value = parseMoney(balanceInput.value);
});
</script>
{% endblock %}
